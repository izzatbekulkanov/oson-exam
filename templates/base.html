{% load static %}
{% load sass_tags %}
{% load i18n %}
<!DOCTYPE html>
<html lang="uz" dir="{{ layout }}">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
          content="Cuba admin is super flexible, powerful, clean &amp; modern responsive bootstrap 5 admin template with unlimited possibilities.">
    <meta name="keywords"
          content="Namangan davlat pedagogika instituti, Tizimlashtirilgan kutubxona xizmati, O'liy ta'lim vazirligi">
    <meta name="author" content="Izzatbek Ulkanov">
    <link rel="icon" href="{% static 'assets/images/favicon.png' %}" type="image/x-icon">
    <link rel="shortcut icon" href="{% static 'assets/images/favicon.png' %}" type="image/x-icon">
    <title>NamDPI - Namangan davlat pedagogika instituti</title>
    <!-- Google font-->
    <link href="https://fonts.googleapis.com/css?family=Rubik:400,400i,500,500i,700,700i&amp;display=swap"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i,900&amp;display=swap"
          rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/font-awesome.css' %}">
    <!-- ico-font-->
    <link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/icofont.scss' %}">
    <!-- Themify icon-->
    <link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/themify.scss' %}">
    <!-- Flag icon-->
    <link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/flag-icon.scss' %}">
    <!-- Feather icon-->
    <link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/feather-icon.scss' %}">
    <!-- Plugins css start-->
    <link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/sweetalert2.scss' %}">
    <link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/slick.scss' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/vendors/slick-theme.css' %}">
    <link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/scrollbar.scss' %}">
    <link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/animate.scss' %}">

    <style>
        .profile-media img {
            width: 35px;
            height: 35px;
            object-fit: cover; /* If you want to maintain aspect ratio */
        }
    </style>

    {% block css %} {% endblock %}

    <!-- Plugins css Ends-->
    <!-- Bootstrap css-->
    <link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/bootstrap.scss' %}"/>
    <!-- App css-->
    <link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/style.scss' %}"/>
    <link id="color" rel="stylesheet" href="{% sass_src 'assets/scss/color-1.scss' %}" media="screen"/>
    <!-- Responsive css-->
    <link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/responsive.scss' %}"/>
</head>

<body class="{{ layout }}" onload="{{ jsFunction }}">
<!-- loader starts-->
<div class="loader-wrapper">
    <div class="loader-index"><span></span></div>
    <svg>
        <defs></defs>
        <filter id="goo">
            <fegaussianblur in="SourceGraphic" stddeviation="11" result="blur"></fegaussianblur>
            <fecolormatrix in="blur" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9" result="goo"></fecolormatrix>
        </filter>
    </svg>
</div>

<div class="toast-container position-fixed bottom-0 end-0 p-3 toast-index toast-rtl">
  <div class="toast fade hide" id="liveToast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex justify-content-between alert-secondary">
      <div class="toast-body">Your time over after 5 minute.</div>
      <button class="btn-close btn-close-white me-2 m-auto" type="button" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>
<!-- loader ends-->
<!-- tap on top starts-->
<div class="tap-top"><i data-feather="chevrons-up"></i></div>
<!-- tap on tap ends-->
<!-- page-wrapper Start-->
<div class="page-wrapper compact-wrapper" id="pageWrapper">
    {% include "layout/header.html" %}
    <!-- Page Body Start-->
    <div class="page-body-wrapper">
        {% include "layout/sidebar.html" %}

        {% block content %} {% endblock %}
        {% include "layout/footer.html" %}
    </div>
</div>


<!-- latest jquery-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<!-- Bootstrap js-->
<script src="{% static 'assets/js/bootstrap/bootstrap.bundle.min.js' %}"></script>
<!-- feather icon js-->
<script src="{% static 'assets/js/icons/feather-icon/feather.min.js' %}"></script>
<script src="{% static 'assets/js/icons/feather-icon/feather-icon.js' %}"></script>
<!-- scrollbar js-->
<script src="{% static 'assets/js/scrollbar/simplebar.js' %}"></script>
<script src="{% static 'assets/js/scrollbar/custom.js' %}"></script>
<!-- Sidebar jquery-->
<script src="{% static 'assets/js/config.js' %}"></script>
<!-- Plugins JS start-->
<script src="{% static 'assets/js/sidebar-menu.js' %}"></script>
<script src="{% static 'assets/js/slick/slick.min.js' %}"></script>
<script src="{% static 'assets/js/slick/slick.js' %}"></script>
<script src="{% static 'assets/js/header-slick.js' %}"></script>

{% block scriptcontent %} {% endblock %}

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Cookie-ni olish uchun yordamchi funksiya
        function getCookie(name) {
            var value = "; " + document.cookie;
            var parts = value.split("; " + name + "=");
            if (parts.length === 2) return parts.pop().split(";").shift();
        }

        // Cookie-ni o'rnatish uchun yordamchi funksiya
        function setCookie(name, value, days) {
            var expires = "";
            if (days) {
                var date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/";
        }

        // Sahifa yuklanayotganda tilni o'zgartirish so'rovini yuborish
        var selectedLanguage = getCookie('selected_language');
        if (!selectedLanguage) {
            selectedLanguage = 'en';
            setCookie('selected_language', selectedLanguage, 365); // 365 kun davomida saqlash
        }

        var langElements = document.querySelectorAll('.lang');
        langElements.forEach(function (element) {
            element.classList.remove('selected');
        });

        var flagIconClass = selectedLanguage === 'en' ? 'us' : selectedLanguage;

        var currentLangElement = document.querySelector('.current_lang');
        currentLangElement.innerHTML = '<div class="lang"><i class="flag-icon flag-icon-' + flagIconClass + '"></i><span class="lang-txt">' + selectedLanguage.toUpperCase() + '</span></div>';

        var selectedElement = document.querySelector('.lang[onclick="changeLanguage(\'' + selectedLanguage + '\')"]');
        if (selectedElement) {
            selectedElement.classList.add('selected');
        }
    });

    function changeLanguage(language) {
        // Tanlangan til turini o'zgartiramiz
        var langElements = document.querySelectorAll('.lang');
        langElements.forEach(function (element) {
            element.classList.remove('selected');
        });

        var selectedElement = document.querySelector('.lang[onclick="changeLanguage(\'' + language + '\')"]');
        selectedElement.classList.add('selected');

        // AJAX so'rovini yuborish
        var csrftoken = getCookie('csrftoken'); // CSRF tokeni olish
        var data = {
            'language': language
        };
        // AJAX so'rovini yuborish
        $.ajax({
            type: 'POST',
            url: '{% url 'set_language' %}', // Tilni o'zgartirish manzili
            data: data,
            beforeSend: function (xhr, settings) {
                xhr.setRequestHeader('X-CSRFToken', csrftoken);
            },
            success: function (response) {
                // Til o'zgartirilgan
                location.reload(); // Sahifani qayta yuklash
            },
            error: function (xhr, status, error) {
                // Xatolik yuz berdi
                console.error('Xatolik:', error);
            }
        });
    }

    // CSRF tokenini olish
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i];
                cookie = cookie.trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>

<script>
    $(document).ready(function () {
        // Button click handler
        $('#ko-rish-btn').on('click', function () {
            // "Kitob berish va qabul qilish" yozuvini o'zgartirish
            $('.data-info-matn h4').text("Xizmat faol emas");
        });

        // Foydalanuvchining rollarini olish
        $.ajax({
            url: "{% url 'get_user_groups' %}",
            type: "GET",
            dataType: "json",
            success: function (data) {
                var groups = data.groups;
                var nowRole = data.now_role;

                // Rollarni HTML ga qo'shish
                $.each(groups, function (index, group) {
                    var activeClass = group.name === nowRole ? 'active' : '';
                    $('.roles').append(
                        '<li class="list-group-item list-group-item-primary text-center ' + activeClass + '">' +
                        '<a href="#" class="text-white text-decoration-none d-block" data-role="' + group.name + '">' + group.name + '</a>' +
                        '</li>'
                    );
                });
            },
            error: function () {
                alert("Rollarni olishda xatolik yuz berdi!");
            }
        });

        // Roli yangilash funksiyasi
        $('.roles').on('click', 'a', function (e) {
            e.preventDefault();
            var selectedRole = $(this).data('role');

            $.ajax({
                url: "{% url 'set_now_role' %}",
                type: "POST",
                data: JSON.stringify({now_role: selectedRole}),
                contentType: "application/json",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
                },
                success: function (response) {
                    if (response.status === 'success') {
                        $('.roles .list-group-item').removeClass('active');
                        $(e.target).closest('.list-group-item').addClass('active');
                        window.location.reload()
                    } else {
                        alert("Rolni yangilashda xatolik yuz berdi!");
                    }
                },
                error: function () {
                    alert("Rolni yangilashda xatolik yuz berdi!");
                }
            });
        });

        // CSRF tokenni olish funksiyasi
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    });
</script>


<!-- Plugins JS Ends-->
<!-- Theme js-->
<script src="{% static 'assets/js/script.js' %}"></script>

{#  <script src="{% static 'assets/js/theme-customizer/customizer.js'%}"></script>#}
<!-- login js-->
<!-- Plugin used-->

{% block script %} {% endblock %}


</body>

</html>